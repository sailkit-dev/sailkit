---
import { getCollection } from 'astro:content';
import { initScript } from '@sailkit-dev/lantern';
import NotFound from '@sailkit-dev/lighthouse/NotFound.astro';
import { getTitle } from '../navigation';

// Build the page list from content collection
const docs = await getCollection('docs');
const pages = docs.map((doc) => ({
  url: `/docs/${doc.slug}/`,
  title: doc.data.title || getTitle(doc.slug),
  section: doc.slug.includes('/') ? doc.slug.split('/')[0] : undefined,
}));
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Page Not Found - Sailkit Docs</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <script is:inline set:html={initScript} />
    <style>
      :root {
        --color-bg: #ffffff;
        --color-text: #1a1a2e;
        --color-text-muted: #64748b;
        --color-surface: #f8fafc;
        --color-border: #e2e8f0;
        --color-accent: #3b82f6;
        --color-accent-hover: #2563eb;
        --color-accent-dim: rgba(59, 130, 246, 0.1);
      }

      [data-theme="dark"] {
        --color-bg: #0f172a;
        --color-text: #f1f5f9;
        --color-text-muted: #94a3b8;
        --color-surface: #1e293b;
        --color-border: #334155;
        --color-accent: #60a5fa;
        --color-accent-hover: #93c5fd;
        --color-accent-dim: rgba(96, 165, 250, 0.15);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      html {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: var(--color-bg);
        color: var(--color-text);
      }

      body {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 2rem;
      }

      .container {
        max-width: 600px;
        width: 100%;
      }

      .header {
        text-align: center;
        margin-bottom: 2rem;
      }

      .header h1 {
        font-size: 4rem;
        font-weight: 800;
        color: var(--color-accent);
        margin-bottom: 0.5rem;
      }

      .header p {
        font-size: 1.125rem;
        color: var(--color-text-muted);
      }

      .actions {
        display: flex;
        gap: 1rem;
        justify-content: center;
        margin-top: 2rem;
      }

      .btn {
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        text-decoration: none;
        font-weight: 500;
        transition: transform 0.15s;
      }

      .btn:hover {
        transform: translateY(-2px);
      }

      .btn-primary {
        background: var(--color-accent);
        color: white;
      }

      .btn-primary:hover {
        background: var(--color-accent-hover);
      }

      .btn-secondary {
        background: var(--color-surface);
        color: var(--color-text);
        border: 1px solid var(--color-border);
      }

      .btn-secondary:hover {
        border-color: var(--color-accent);
      }

      /* Lighthouse component overrides */
      :global(.lighthouse-container) {
        background: var(--color-surface);
        border: 1px solid var(--color-border);
        border-radius: 12px;
        padding: 1.5rem;
      }

      :global(.lighthouse-title) {
        color: var(--color-text);
        font-weight: 600;
      }

      :global(.lighthouse-suggestion) {
        padding: 0.75rem 1rem;
        border-radius: 8px;
        text-decoration: none;
        color: var(--color-text);
        display: block;
        transition: background-color 0.15s;
      }

      :global(.lighthouse-suggestion:hover) {
        background: var(--color-accent-dim);
      }

      :global(.lighthouse-suggestion-title) {
        color: var(--color-accent);
        font-weight: 500;
      }

      :global(.lighthouse-redirect-notice) {
        background: var(--color-accent-dim);
        border: 1px solid var(--color-accent);
        border-radius: 8px;
        padding: 1rem;
        text-align: center;
        color: var(--color-text);
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>404</h1>
        <p>This page doesn't exist, but we might know where you wanted to go.</p>
      </div>

      <NotFound
        pages={pages}
        autoRedirectThreshold={0.6}
        maxSuggestions={5}
        redirectDelay={1500}
      >
        <Fragment slot="actions">
          <div class="actions">
            <a href="/" class="btn btn-primary">Go Home</a>
            <a href="/docs/introduction/" class="btn btn-secondary">Browse Docs</a>
          </div>
        </Fragment>
      </NotFound>
    </div>
  </body>
</html>
